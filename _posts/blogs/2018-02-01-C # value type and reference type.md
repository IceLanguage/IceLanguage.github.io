---
layout: page
---

# C#篇-值类型和引用类型

----------
[TOC]

##区别
值类型和引用类型的最大区别：值类型变量直接包含值
一个值类型变量赋给另一个值类型变量时，复制其包含的值，引用类型的赋值则是复制对象的引用，不复制对象本身

值类型不能派生其他类型，值类型实例**一般**分配在线程栈上，相比引用类型，值类型使用缓解了托管堆的压力

##类型的内存分配
局部变量存储在线程栈上，实例变量值和实例存储在实例存储的地方，引用类型实例和静态变量存储在堆上
值类型实例一般分配在线程栈上，但不全是线程栈，比如数组的元素，引用类型的值类型字段，迭代器的局部变量，匿名函数的局部变量会分配在托管堆上，因为分配在线程栈上会出现线程栈方法调用结束后却依旧在访问这些值的情况。

##值类型特征
1.不可派生
2.不需要继承
3.不可变（string是引用类型）
4.值方式传递（不需要在托管堆分配，所以性能会更好，但数据实例过大会造成性能损耗）
5.继承自System.ValueType

##优先使用值类型的情景
1.实例较小
2.不含虚方法

##装箱拆箱
装箱的本质：在托管分配内存并将值类型字段复制到堆内存中，接着返回对象的引用
拆箱的本质：是引用的值分配到一个值类型的实例中

所以拆箱并不是装箱的逆过程。
注意：拆箱必须告诉编译器正确的类型，否则会报错。